<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>分类: IT - Slack Ideas</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="CAI SKI"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="CAI SKI"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Slack Ideas"><meta property="og:url" content="https://www.slackideas.com/"><meta property="og:site_name" content="Slack Ideas"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.slackideas.com/img/og_image.png"><meta property="article:author" content="caiski"><meta property="article:tag" content="Slack Ideas, Slack, Ideas"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.slackideas.com"},"headline":"Slack Ideas","image":["https://www.slackideas.com/img/og_image.png"],"author":{"@type":"Person","name":"caiski"},"publisher":{"@type":"Organization","name":"Slack Ideas","logo":{"@type":"ImageObject","url":"https://www.slackideas.com/about/index/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Slack Ideas" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/about/index/logo.svg" alt="Slack Ideas" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">IT</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-06T15:43:00.000Z" title="12/6/2020, 11:43:00 PM">2020-12-06</time>发表</span><span class="level-item"><time dateTime="2022-04-16T11:47:46.722Z" title="4/16/2022, 7:47:46 PM">2022-04-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/IT/">IT</a></span><span class="level-item">7 分钟读完 (大约1066个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/06/Dealing-With-A-MySQL-Deadlock-Problem-Caused-By-Concurrent-DML/">Dealing With A MySQL Deadlock Problem Caused By Concurrent DML</a></h1><div class="content"><h1 id="记一次由并发DML引起的MySQL死锁场景"><a href="#记一次由并发DML引起的MySQL死锁场景" class="headerlink" title="记一次由并发DML引起的MySQL死锁场景"></a>记一次由并发DML引起的MySQL死锁场景</h1><p>一次出差中，在客户现场遇到了由并发DML引起的MySQL死锁场景</p>
<h2 id="场景再现"><a href="#场景再现" class="headerlink" title="场景再现"></a>场景再现</h2><p>首先把场景重现并简化，触发条件：①事务隔离级别为InnoDB默认的REPEATABLE-READ，②有多个Session同时进行事务操作，而事务的内容是先删除一行特定记录然后重新插入该记录。</p>
<p>如下图所示：</p>
<p><img src="/2020/12/06/Dealing-With-A-MySQL-Deadlock-Problem-Caused-By-Concurrent-DML/Transaction-Deadlock-Demo.png"></p>
<p>数据库<code>show engine innodb status</code>吐出的死锁信息如下：</p>
<pre><code>------------------------
LATEST DETECTED DEADLOCK
------------------------
2020-12-06 22:14:23 0x70000ca32000
*** (1) TRANSACTION:
TRANSACTION 1563, ACTIVE 34 sec inserting
mysql tables in use 1, locked 1
LOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 21, OS thread handle 123145523712000, query id 86 localhost root update
insert into tb values(1)

*** (1) HOLDS THE LOCK(S):
RECORD LOCKS space id 2 page no 4 n bits 72 index PRIMARY of table `test`.`tb` trx id 1563 lock_mode X
Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0
 0: len 8; hex 73757072656d756d; asc supremum;;


*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 2 page no 4 n bits 72 index PRIMARY of table `test`.`tb` trx id 1563 lock_mode X insert intention waiting
Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0
 0: len 8; hex 73757072656d756d; asc supremum;;


*** (2) TRANSACTION:
TRANSACTION 1564, ACTIVE 21 sec inserting
mysql tables in use 1, locked 1
LOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 29, OS thread handle 123145523408896, query id 87 localhost root update
insert into tb values(2)

*** (2) HOLDS THE LOCK(S):
RECORD LOCKS space id 2 page no 4 n bits 72 index PRIMARY of table `test`.`tb` trx id 1564 lock_mode X
Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0
 0: len 8; hex 73757072656d756d; asc supremum;;


*** (2) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 2 page no 4 n bits 72 index PRIMARY of table `test`.`tb` trx id 1564 lock_mode X insert intention waiting
Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0
 0: len 8; hex 73757072656d756d; asc supremum;;

*** WE ROLL BACK TRANSACTION (2)
</code></pre>
<p>从死锁信息中可以看出，两个事务持有的锁是锁在相同的一块区域上：</p>
<pre><code>0: len 8; hex 73757072656d756d; asc supremum;;
</code></pre>
<h2 id="死锁分析"><a href="#死锁分析" class="headerlink" title="死锁分析"></a>死锁分析</h2><p>上面已经指出了不同的SQL语句会加什么锁，更加详细的内容可以在这里看：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html">15.7.3 Locks Set by Different SQL Statements in InnoDB</a></p>
<p>我们只看本次场景涉及到的DELETE和INSERT语句。</p>
<h3 id="DELETE语句的锁操作"><a href="#DELETE语句的锁操作" class="headerlink" title="DELETE语句的锁操作"></a>DELETE语句的锁操作</h3><pre><code>DELETE FROM ... WHERE ... sets an exclusive next-key lock on every record the search encounters. 
However, only an index record lock is required for statements that lock rows using a unique index to search for a unique row.

DELETE FROM ... WHERE ...会在所有满足条件的记录上都设置一个排他的next-key锁，即锁住之前的Gap和待删除的记录。
如果删除的数据比当前最大数据max还大，就会锁住(max, +∞)这个GAP；如果删除的数据比当前最小数据min还小，则会锁住(-∞, min)这个GAP。

不过要注意：如果待搜索字段是用唯一键搜索的，那么只会加一个Index Record Lock。
</code></pre>
<p><em>至于为何会出现+∞和-∞两个概念，请看这里<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/internals/en/innodb-infimum-and-supremum-records.html">22.2.1.3 The Infimum and Supremum Records</a></em></p>
<h3 id="INSERT语句的锁操作"><a href="#INSERT语句的锁操作" class="headerlink" title="INSERT语句的锁操作"></a>INSERT语句的锁操作</h3><p>插入语句由于引入意向锁(Insert Intetion Lock)，会稍微复杂一些。</p>
<pre><code>INSERT sets an exclusive lock on the inserted row. This lock is an index-record lock, not a next-key lock (that is, there is no gap lock) and does not prevent other sessions from inserting into the gap before the inserted row.

INSERT 会在待插入记录上加排他锁，它是行锁而非GAP锁，并不会阻塞其他会话在该行之前的GAP插入数据。

Prior to inserting the row, a type of gap lock called an insert intention gap lock is set. This lock signals the intent to insert in such a way that multiple transactions inserting into the same index gap need not wait for each other if they are not inserting at the same position within the gap. 

但在插入之前，一个名为Insert Intention Gap Lock的GAP锁会加在待插入区域，本次场景中即为(5,+∞)区域。
</code></pre>
<h3 id="GAP锁的作用"><a href="#GAP锁的作用" class="headerlink" title="GAP锁的作用"></a>GAP锁的作用</h3><p>GAP锁作用是，防止其他事务在这个gap内的插入，但不排斥其他事务在同一个gap内加GAP锁，因此Gap X锁和Gap S锁效果相同。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>直接解决方法：将事务隔离级别由REPEATABLE-READ改为READ-COMMITTED。</p>
<p>因为在RR隔离级别中，读会加排他锁，而RC隔离级别中读只会加共享锁，这样可以避免出现本次场景中的互锁现象。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-12-21T11:11:55.000Z" title="12/21/2019, 7:11:55 PM">2019-12-21</time>发表</span><span class="level-item"><time dateTime="2022-04-16T11:47:46.722Z" title="4/16/2022, 7:47:46 PM">2022-04-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/IT/">IT</a></span><span class="level-item">5 分钟读完 (大约801个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/12/21/The-Sequence-Of-Multi-matches-In-Regex-Expression/">The Sequence Of Multi-matches In Regex Expression</a></h1><div class="content"><h1 id="正则表达式多选结构的顺序"><a href="#正则表达式多选结构的顺序" class="headerlink" title="正则表达式多选结构的顺序"></a>正则表达式多选结构的顺序</h1><h2 id="先看一道编程题"><a href="#先看一道编程题" class="headerlink" title="先看一道编程题"></a>先看一道编程题</h2><blockquote>
<p>从一段只包含[<code>.</code>,<code>0</code>-<code>9</code>]字符的字符串中提取出全部可能的IPv4地址。</p>
<p>IPv4地址由十进制数和点来表示，每个地址包含4个十进制数，其范围为<code>0-255</code>,比如<code>172.16.254.1</code>；同时，4个十进制数不会以<code>0</code>开头，比如<code>172.16.254.01</code>是不合法的。</p>
<p>现输入一段文本<code>str=&quot;1.1.1111.16..172.16.254.1.1&quot;</code>，要求用程序答出该字符串所有子串可能形成的IPv4地址。</p>
</blockquote>
<p>很多人会想到，<code>IPv4的正则表达式我可熟悉啦，肯定能快速完成！</code>于是从网上搜索到IPv4的正则表达式，写出了以下代码：</p>
<pre><code class="java">// Java语言
import java.util.*;
import java.util.regex.*;

class Solution &#123;
    private static final Pattern IPV4_PATTERN =
            Pattern.compile(&quot;((([1-9][0-9]?)|(1[0-9]&#123;2&#125;)|(2[0-4]\\d)|(25[0-5])|0)\\.)&#123;3&#125;&quot; +
                    &quot;(([1-9][0-9]?)|(1[0-9]&#123;2&#125;)|(2[0-4]\\d)|(25[0-5])|0)&quot;);

    public Set&lt;String&gt; findAllIpv4(String input) &#123;
        Set&lt;String&gt; s = new TreeSet&lt;String&gt;();
        Matcher m = IPV4_PATTERN.matcher(input);
        int from = 0;
        while (m.find(from)) &#123;
            s.add(input.substring(m.start(), m.end()));
            from++;
        &#125;
        return s;
    &#125;
&#125;
</code></pre>
<p>我们看完这一段代码，可以确定的是：1. 正则表达式没问题，正确的IPV4地址可以用它来验证；2. Java Regex API用法也没有太大问题，基本符合预期。</p>
<pre><code>输入：0.0.0.255
输出：[0.0.0.25]
</code></pre>
<p>但这段代码的结果是不正确的，正确输出是<code>[0.0.0.2, 0.0.0.25, 0.0.0.255]</code>，原因就出在正则中多选结构<code>|</code>的用法上。</p>
<h2 id="多选结构（Alternation）"><a href="#多选结构（Alternation）" class="headerlink" title="多选结构（Alternation）"></a>多选结构（Alternation）</h2><p>多选结构在不同的正则引擎中，工作原理是截然不同的。在传统型<code>NFA</code>引擎中，会按照从左到右的顺序检查表达式中的多选分支，一旦可以匹配完成，<strong>其他的多选分支就不会尝试了</strong>。[^1]</p>
<p>以上节的正则表达式为例，我们单独摘出每个十进制数的表达式<code>(([1-9][0-9]?)|(1[0-9]&#123;2&#125;)|(2[0-4]\\d)|(25[0-5])|0)</code>，它会以如下顺序进行匹配：</p>
<pre><code>1. ([1-9][0-9]?)      # 一位数或两位数
2. (1[0-9]&#123;2&#125;)        # 位于区间[100-199]的三位数
3. (2[0-4]\\d)        # 位于区间[200-249]的三位数
4. (25[0-5])          # 位于区间[250-255]的三位数
5. 0                  # 0
</code></pre>
<p>那么在针对输入字符串<code>0.0.0.255</code>的匹配过程中，在进行第四个十进制数<code>255</code>的匹配时，会优先计算表达式<code>([1-9][0-9]?)</code>，这样可以匹配到<code>25</code>和<code>2</code>，而<code>?(question mark)</code>在正则中是一个贪婪量词[^2]，因此仅会留下<code>25</code>，所以最终我们看到了运行结果是<code>[0.0.0.25]</code>。</p>
<p>以这些知识为前提，我们可以通过<code>优先匹配多位数字，手工解析少量数字</code>的方式得到正确的解答程序，这样做的话，正则表达式需要做一些调整，将多位数匹配的多选分支放在前面，即<code>(25[0-5]|2[0-4]\\d|1\\d&#123;2&#125;|[1-9]\\d|\\d)</code>，代码如下：</p>
<pre><code class="java">// Java语言
import java.util.*;
import java.util.regex.*;

class Solution &#123;
    private static final Pattern IPV4_PATTERN =
            Pattern.compile(&quot;((25[0-5]|2[0-4]\\d|1\\d&#123;2&#125;|[1-9]\\d|\\d)\\.)&#123;3&#125;&quot; +
                    &quot;(25[0-5]|2[0-4]\\d|1\\d&#123;2&#125;|[1-9]\\d|\\d)&quot;);

    public Set&lt;String&gt; findAllIpv4(String input) &#123;
        Set&lt;String&gt; s = new TreeSet&lt;String&gt;();
        Matcher m = IPV4_PATTERN.matcher(input);
        int from = 0;
        int lastDotIdx = 0;
        String sub = null;
        while (m.find(from)) &#123;
            sub = input.substring(m.start(), m.end());
            s.add(sub);
            lastDotIdx = sub.lastIndexOf(&#39;.&#39;);
            if (lastDotIdx == sub.length() - 3) &#123;
                s.add(sub.substring(0, sub.length() - 1));
            &#125; else if (lastDotIdx == sub.length() - 4) &#123;
                s.add(sub.substring(0, sub.length() - 1));
                s.add(sub.substring(0, sub.length() - 2));
            &#125;
            from++;
        &#125;
        return s;
    &#125;
&#125;
</code></pre>
<p>[^1]: Friedl, J. E. (2006). Mastering regular expressions. “ O’Reilly Media, Inc.”, p174-p175.</p>
<p>[^2]: Friedl, J. E. (2006). Mastering regular expressions. “ O’Reilly Media, Inc.”, p142.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-11-24T13:24:56.000Z" title="11/24/2019, 9:24:56 PM">2019-11-24</time>发表</span><span class="level-item"><time dateTime="2022-04-16T11:47:46.722Z" title="4/16/2022, 7:47:46 PM">2022-04-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/IT/">IT</a></span><span class="level-item">5 分钟读完 (大约727个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/24/The-Brief-Introduction-Of-JVM-G1/">The Brief Introduction Of JVM G1</a></h1><div class="content"><h1 id="JVM-G1垃圾回收算法简要介绍"><a href="#JVM-G1垃圾回收算法简要介绍" class="headerlink" title="JVM G1垃圾回收算法简要介绍"></a>JVM G1垃圾回收算法简要介绍</h1><h2 id="G1的特点"><a href="#G1的特点" class="headerlink" title="G1的特点"></a>G1的特点</h2><ol>
<li>能够像CMS垃圾回收算法一样并发操作应用线程（潜台词：多核）</li>
<li>无需太长时间即可压缩空闲内存空间（潜台词：不会引起太多的GC停顿时间）</li>
<li>尽可能地让GC时长可控</li>
<li>不希望牺牲过多的吞吐量</li>
<li>不希望因此耗费大量更多的Heap空间</li>
</ol>
<h2 id="G1的优势"><a href="#G1的优势" class="headerlink" title="G1的优势"></a>G1的优势</h2><p>G1作为CMS的长期替代品，有若干点优势：</p>
<ol>
<li>G1是一个压缩收集器，提供足够强的压缩来完全避免狭小的内存分配</li>
<li>依赖Regions概念，大大简化收集器逻辑，大部分情况下规避潜在的内存碎片问题</li>
<li>比CMS的GC停顿时长更加可预测，并允许用户指定停顿时长</li>
</ol>
<h2 id="G1的收集步骤"><a href="#G1的收集步骤" class="headerlink" title="G1的收集步骤"></a>G1的收集步骤</h2><p>Phase 1: Concurrent Global Marking. 并发扫描一遍之后，G1知道了哪些Region里大部分是空的（即大部分是可回收的对象），G1把收集和压缩操作集中于此，因此得名Garbage First.</p>
<p>Phase 2: Evacuation. 并发地将一个或多个Region的资源拷贝至新的Region，压缩内存、拷贝、释放已拷贝完成的Region. 与此相比，CMS没有压缩内存（去除碎片）这一步，ParallelOld垃圾收集只进行全堆压缩.</p>
<p>细节：G1会估算Region的回收时间，以计算在用户指定时间内可回收多少（量力而行），因此G1不是『实时』收集器 ：）</p>
<h2 id="G1的建议使用场景"><a href="#G1的建议使用场景" class="headerlink" title="G1的建议使用场景"></a>G1的建议使用场景</h2><p>拥有较大Heap空间（6GB及以上）、低停顿时长（0.5ms以内）要求的应用。</p>
<p>现在使用ParallelGC或CMS的应用，如果存在以下问题，可以考虑切换至G1：</p>
<ol>
<li>Full GC过于频繁、停顿时间过长的应用</li>
<li>对象分配比例经常发生剧变的应用</li>
<li>回收或压缩时间太长的应用（高于0.5s到1s）</li>
</ol>
<p>如果使用ParallelGC或CMS没有发现以上现象，可以不必急于切换到G1，新版JVM仍然支持旧的垃圾回收算法。</p>
<h2 id="G1的注意事项"><a href="#G1的注意事项" class="headerlink" title="G1的注意事项"></a>G1的注意事项</h2><p>若从ParallelOldGC或CMS切换至G1，很可能会发现JVM运行内存变大了。这很大程度上要归因于 用于审计的两个数据结构『Remembered Sets』和『Collection Sets』</p>
<ol>
<li>『Remembered Sets』每个Region都有一个，用于记录该Region中的对象引用，给G1提供并行独立收集各Region内存的可能性，它带来的负面影响不超5%</li>
<li>『Collection Sets』记录被收集的Region，它内部的所有数据会被收集干净，它带来的负面影响不超1%</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-05-19T12:22:04.000Z" title="5/19/2018, 8:22:04 PM">2018-05-19</time>发表</span><span class="level-item"><time dateTime="2022-04-16T11:47:46.722Z" title="4/16/2022, 7:47:46 PM">2022-04-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/IT/">IT</a></span><span class="level-item">7 分钟读完 (大约1076个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/05/19/Java-Performance-Extreme-Programming/">Java Performance Extreme Programming</a></h1><div class="content"><h1 id="Java性能极限编程-转载"><a href="#Java性能极限编程-转载" class="headerlink" title="Java性能极限编程(转载)"></a>Java性能极限编程(转载)</h1><h2 id="不同位数的Hash算法的碰撞概率"><a href="#不同位数的Hash算法的碰撞概率" class="headerlink" title="不同位数的Hash算法的碰撞概率"></a>不同位数的Hash算法的碰撞概率</h2><ul>
<li>32位的Hash算法，无论使用哪一种，都会存在碰撞。</li>
<li>128位的Hash算法（比如MD5）基本找不到碰撞，但性能不够好。</li>
<li>64位的Hash算法，取值范围42亿的平方，基本找不到碰撞。比如，在值范围量并不超过100万的场景，可以假设唯一。</li>
</ul>
<h2 id="FNV-1a-64算法"><a href="#FNV-1a-64算法" class="headerlink" title="FNV_1a_64算法"></a>FNV_1a_64算法</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function">FNV</a>算法，其改进版本是fnv_1a，fnv是一种非常简洁并有效的hash算法，具体实现如下：</p>
<pre><code class="java">public static long fnv1a_64(String chars) &#123;
    long hash = 0xcbf29ce484222325L;
    for (int i = 0; i &lt; chars.length(); ++i) &#123;
        char c = chars.charAt(i);
        hash ^= c;
        hash *= 0x100000001b3L;
    &#125;

    return hash;
&#125;
</code></pre>
<p>在上面的代码看来，可以做增量计算。增量计算可以用来很多场景优化，比如class的fullName由package和simpleName组成，如果已经计算了package的hashCode，就是在此基础上计算fullName的hashCode，不用从头开始计算，这在很多场景可以优化性能。</p>
<h2 id="增量计算的实现"><a href="#增量计算的实现" class="headerlink" title="增量计算的实现"></a>增量计算的实现</h2><pre><code class="java">public static long fnv1a_64_increment(long basic, char seperator, String chars) &#123;
    long hashCode = basic;
    
    // 补上分隔符的Hash增量
    hashCode ^= seperator;
    hashCode *= 0x100000001b3L;

    // 补上SimpleName的Hash增量
    for (int i = 0; i &lt; chars.length(); ++i) &#123;
        char ch = chars.charAt(i);
        hashCode ^= ch;
        hashCode *= 0x100000001b3L;
    &#125;

    return hashCode;
&#125;

// 先计算package的Hash
long pkgHashCode64 = fnv1a_64(&quot;com.alibaba.xxx&quot;);

// 增量计算fullName的HashCode
long fullNameHashCode64 = fnv1a_64_increment(pkgHashCode64, &#39;.&#39;, &quot;MyClassName&quot;);
</code></pre>
<h2 id="大小写无关的FNV-Hash算法实现"><a href="#大小写无关的FNV-Hash算法实现" class="headerlink" title="大小写无关的FNV Hash算法实现"></a>大小写无关的FNV Hash算法实现</h2><p>在SQL分析等场景，为了更好的用户体验，对象名查找需要大小写不敏感。</p>
<pre><code class="java">public static long fnv1a_64_lower(String key) &#123;
    long hashCode = 0xcbf29ce484222325L;;
    for (int i = 0; i &lt; key.length(); ++i) &#123;
        char ch = key.charAt(i);

        // 所有大写都转成小写
        if (ch &gt;= &#39;A&#39; &amp;&amp; ch &lt;= &#39;Z&#39;) &#123;
            ch = (char) (ch + 32);
        &#125;

        hashCode ^= ch;
        hashCode *= 0x100000001b3L;
    &#125;

    return hashCode;
&#125;
</code></pre>
<h2 id="二分查找和fnv-1a-hash-64组合使用"><a href="#二分查找和fnv-1a-hash-64组合使用" class="headerlink" title="二分查找和fnv_1a_hash_64组合使用"></a>二分查找和fnv_1a_hash_64组合使用</h2><pre><code class="java">String[] strings = &#123; &quot;AVG&quot;, &quot;COUNT&quot;, &quot;MAX&quot;, &quot;MIN&quot;, &quot;STDDEV&quot;, &quot;SUM&quot; &#125;;

// 计算hashCodes并且排序
long[] hashCodes = new long[strings.length];
for (int i = 0; i &lt; strings.length; i++) &#123;
    hashCodes[i] = fnv1a_64_lower(strings[i]);
&#125;
Arrays.sort(hashCodes);

// 建立根据hashCode排序的映射关系
String[] keywords = new String[hashCodes.length];
for (String str : strings) &#123;
    long hash = FnvHash.fnv1a_64_lower(str);
    int index = Arrays.binarySearch(hashCodes, hash);
    keywords[index] = str;
&#125;

// 根据hashCode二分查找到位置，然后获取
public String getKeyword(long hash) &#123;
    int index = Arrays.binarySearch(hashCodes, hash);
    if (index &lt; 0) &#123;
        return null;
    &#125;
    return keywords[index];
&#125;
</code></pre>
<h2 id="替换hashCode和equals实现"><a href="#替换hashCode和equals实现" class="headerlink" title="替换hashCode和equals实现"></a>替换hashCode和equals实现</h2><pre><code class="java">class SQLIdentifierExpr &#123;
    private String    name;
    private long      hashCode64;
    
    public SQLIdentifierExpr(String name, long hash_lower)&#123;
        this.name = name;
        this.hashCode64 = hash_lower;
    &#125;
    
    @Override
    public int hashCode() &#123;
        long value = hashCode64;
        return (int)(value ^ (value &gt;&gt;&gt; 32));
    &#125;
    
    @Override
    public boolean equals(Object obj) &#123;
        if (!(obj instanceof SQLIdentifierExpr)) &#123;
            return false;
        &#125;
    
        SQLIdentifierExpr other = (SQLIdentifierExpr) obj;
        
        // hashCode64相等就假设相等
        return this.hashCode64 == other.hashCode64; 
    &#125;
&#125;
</code></pre>
<h2 id="应用举例-使用HashCode64替换字符串比较"><a href="#应用举例-使用HashCode64替换字符串比较" class="headerlink" title="应用举例 使用HashCode64替换字符串比较"></a>应用举例 使用HashCode64替换字符串比较</h2><p>在Druid SQL Parser中，抽象与发分析时，使用了通过比较hashCode64替代字符串比较，极大提升语义分析的性能。</p>
<pre><code class="java">public class SQLExprTableSource extends SQLTableSourceImpl &#123;

    protected SQLExpr     expr;
    public SQLTableSource findTableSource(long alias_hash) &#123;
        if (alias_hash == 0) &#123;
            return null;
        &#125;

        if (aliasHashCode64() == alias_hash) &#123;
            return this;
        &#125;

        if (expr instanceof SQLName) &#123;
            long exprNameHash = ((SQLName) expr).nameHashCode64();
            if (exprNameHash == alias_hash) &#123;
                return this;
            &#125;
        &#125;

        if (expr instanceof SQLPropertyExpr) &#123;
            long hash = ((SQLPropertyExpr) expr).hashCode64();
            if (hash == alias_hash) &#123;
                return this;
            &#125;
        &#125;

        return null;
    &#125;
&#125; 
</code></pre>
<h2 id="应用举例-fastjson-android版本属性名快速匹配"><a href="#应用举例-fastjson-android版本属性名快速匹配" class="headerlink" title="应用举例 fastjson android版本属性名快速匹配"></a>应用举例 fastjson android版本属性名快速匹配</h2><pre><code>// JSON字符串
&#123;”id”:1001,”name”:”wenshao”&#125;

// 类定义
public class Person &#123;
   public int id;
   public String name;
&#125;

// 读取属性名的fnv_1a_hashCode64
public long readNameHash() &#123;
    long hash = 0x811c9dc5;
    for (; i &lt; text.length; ++p) &#123;
        char ch = text.charAt(p);
        if (ch == &#39;&quot;&#39;) break;
            hash ^= ch;
            hash *= 0x1000193;
        &#125;
    return hash;
&#125;

// 把fieldName hash读取出来，查找对应的FieldDeserializer
// 避免了构造fieldName的字符串，减少内存分配，也提升了fndFieldDeserializer的性能
long nameHash = readNameHash();
FieldDeserializer fieldDeser = fndFieldDeserializer(nameHash);
if (fieldDeser != null) &#123;
   fieldDeser.readValue();
&#125;
// 以上为伪码，真实实现会复杂很多
</code></pre>
<h2 id="更多应用场景"><a href="#更多应用场景" class="headerlink" title="更多应用场景"></a>更多应用场景</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/wiki/SQL-Parser">Druid SQL Parser</a> 在Parser是使用fnv_1a_hash优化Parser性能，并且将hashCode64保存到AST（抽象语法树）节点上，用于加速分析时节点查找。比如 [<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/blob/master/src/main/java/com/alibaba/druid/sql/ast/expr/SQLIdentifierExpr.java#L42]">https://github.com/alibaba/druid/blob/master/src/main/java/com/alibaba/druid/sql/ast/expr/SQLIdentifierExpr.java#L42]</a></li>
<li>Fastjson在parse属性名时使用hashCode加速，比如 <a target="_blank" rel="noopener" href="https://github.com/alibaba/fastjson/blob/android/src/main/java/com/alibaba/fastjson/parser/JSONLexer.java#L2056">https://github.com/alibaba/fastjson/blob/android/src/main/java/com/alibaba/fastjson/parser/JSONLexer.java#L2056</a></li>
<li>数据库相关的应用的基于Name的查找</li>
<li>类名查找</li>
<li>RPC场景的方法Signature匹配</li>
<li>两个数据表算delta</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-03-02T12:23:24.000Z" title="3/2/2018, 8:23:24 PM">2018-03-02</time>发表</span><span class="level-item"><time dateTime="2022-04-16T11:47:46.718Z" title="4/16/2022, 7:47:46 PM">2022-04-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/IT/">IT</a></span><span class="level-item">9 分钟读完 (大约1284个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/03/02/A-Troubleshooting-Case-On-Mixed-Logging-Frameworks-In-Java-Maven-Projects/">A Troubleshooting Case On Mixed Logging Frameworks In Java Maven Projects</a></h1><div class="content"><h1 id="一次日志框架排坑记录"><a href="#一次日志框架排坑记录" class="headerlink" title="一次日志框架排坑记录"></a>一次日志框架排坑记录</h1><p>一个Java项目中，由于引入的依赖可能使用各种不同的日志框架，并且各个模块的开发人员在没有硬性要求时会习惯性地使用自己熟悉的框架，这就导致项目中对各种日志框架的依赖各式各样，排查起来很麻烦。</p>
<p>例如，项目写日志的代码中，有直接使用Log4j的这种写法：</p>
<pre><code class="java">// 使用 log4j.log4j 1.2.17
import org.apache.log4j.Logger;

...
private Logger logger = Logger.getLogger(DBConnectionUtils.class);

logger.error(&quot;error&quot;);
...
</code></pre>
<p>也有直接使用 Log4j 2的写法：</p>
<pre><code class="java">// 使用 org.apache.logging.log4j.log4j-api 2.10.0
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

...
private Logger logger = LogManager.getLogger(&quot;loggerName&quot;);
logger.error(&quot;error&quot;);
...
</code></pre>
<p>还有使用 Slf4j 的写法：</p>
<pre><code class="java">// 使用 org.slf4j.slf4j-api 1.7.25
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

...
public Logger logger = LoggerFactory.getLogger(&quot;loggerName&quot;);
logger.error(&quot;error&quot;);
...
// 或使用 lombok 的Slf4j注解 
import lombok.extern.slf4j.Slf4j;

// 利用注解产生log变量
@Slf4j
public class TestClass &#123;
  public void testMethod() &#123;
    log.error(&quot;error&quot;);
  &#125;
&#125;
</code></pre>
<p>由于项目日志的配置使用的log4j.xml，对应 log4j2 ，因此 log4j1 的使用应该是无效的，所有显式使用log4j1的地方需要全部改掉。</p>
<p>Slf4j 是一个日志接口，能兼容多种日志实现，如 log4j / JCL(java commons logging) / logback / java.util.logging , 能带来很好的扩展性，建议使用。因此所有显式使用 log4j2 的代码也需要改成 slf4j 。</p>
<p>由于三种写法的代码文件都很多，必须写一个脚本来实现代码替换，预先将目标文件的路径存放于 tmp_list 中，然后在同目录下执行下列脚本：</p>
<pre><code class="bash">#!/bin/sh
# Env: MacBookPro11,4; 版本 10.13.3（版号 17D47） 

for DIR in `cat tmp_list`; do

echo $DIR

# 替换import org.apache.log4j.Logger;这行
find $DIR -type f -name *.java -exec sed -i &#39;&#39; &#39;/import org.apache.log4j.Logger;/d&#39; &#123;&#125; \;

# 替换*Logger logger =*这行
find $DIR -type f -name *.java -exec sed -i &#39;&#39; &#39;/Logger logger =/d&#39; &#123;&#125; \;

# 替换logger为log
find $DIR -type f -name *.java -exec sed -i &#39;&#39; &#39;s/logger/log/g&#39; &#123;&#125; \;

# 在public abstract class上一行添加@Slf4j
find $DIR -type f -name *.java -exec sed -i &#39;&#39; &#39;/public abstract class/i\
@lombok.extern.slf4j.Slf4j\
&#39; &#123;&#125; \;

# 在public class上一行添加@Slf4j
find $DIR -type f -name *.java -exec sed -i &#39;&#39; &#39;/public class/i\
@lombok.extern.slf4j.Slf4j\
&#39; &#123;&#125; \;

done;
</code></pre>
<p>执行结束后，代码编译通过，说明没有明显的替换错误。但是工程启动后，发现有报错，TDDL 客户端抛出了以下异常(已经隐去不相干的若干行)：</p>
<pre><code>JM.Log:ERROR Failed to get Slf4jLogger
java.lang.IllegalArgumentException: delegate must be logback impl or slf4j-log4j impl
    at com.taobao.middleware.logger.slf4j.Slf4jLogger.&lt;init&gt;(Slf4jLogger.java:50)
    at com.taobao.middleware.logger.slf4j.Slf4jLoggerFactory.getLogger(Slf4jLoggerFactory.java:17)
    at com.taobao.middleware.logger.LoggerFactory.getLogger(LoggerFactory.java:60)
    at com.taobao.middleware.logger.LoggerFactory.getLogger(LoggerFactory.java:69)
    at com.taobao.diamond.client.impl.LogUtils.logger(LogUtils.java:36)
    at com.taobao.diamond.client.impl.DiamondEnv.&lt;clinit&gt;(DiamondEnv.java:696)
    at com.taobao.diamond.client.impl.DiamondEnvRepo.&lt;clinit&gt;(DiamondEnvRepo.java:93)
    at com.taobao.tddl.config.diamond.DiamondConfigDataHandler.doInit(DiamondConfigDataHandler.java:50)
    at com.taobao.tddl.common.model.lifecycle.AbstractLifecycle.init(AbstractLifecycle.java:32)
    at com.taobao.tddl.config.impl.PreheatDataHandler.doInit(PreheatDataHandler.java:37)
    at com.taobao.tddl.common.model.lifecycle.AbstractLifecycle.init(AbstractLifecycle.java:32)
    at com.taobao.tddl.config.impl.UnitConfigDataHandlerFactory.getConfigDataHandler(UnitConfigDataHandlerFactory.java:66)
    at com.taobao.tddl.config.impl.UnitConfigDataHandlerFactory.getConfigDataHandler(UnitConfigDataHandlerFactory.java:52)
    at com.taobao.tddl.matrix.jdbc.TDataSource.loadConnectionProperties(TDataSource.java:197)
    at com.taobao.tddl.matrix.jdbc.TDataSource.doInit(TDataSource.java:127)
    at com.taobao.tddl.common.model.lifecycle.AbstractLifecycle.init(AbstractLifecycle.java:32)
    ...
    ...
    at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:829)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:357)
    at sun.rmi.transport.Transport$1.run(Transport.java:200)
    at sun.rmi.transport.Transport$1.run(Transport.java:197)
    at java.security.AccessController.doPrivileged(Native Method)
    at sun.rmi.transport.Transport.serviceCall(Transport.java:196)
    at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)
    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)
    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)
    at java.security.AccessController.doPrivileged(Native Method)
    at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
    at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.NullPointerException
    at java.lang.Class.forName0(Native Method)
    at java.lang.Class.forName(Class.java:264)
    at com.taobao.middleware.logger.slf4j.Slf4jLogger.&lt;init&gt;(Slf4jLogger.java:46)
    ... 115 more
</code></pre>
<p>通过Debug，发现问题出在这里：</p>
<p>从上图可以看到，tddl 底层的中间件代码中，日志代理类只可以是 ch.qos.logback.classic.Logger 和 org.slf4j.impl.Log4jLoggerAdapter, 而我们的代理类却默认初始化成了 org.apache.logging.slf4j.Log4jLogger, 为什么会出现这个情况呢？猜测 log4j-slf4j-impl 在初始化的时候是优先于 slf4j-log4j12 的 ，把 org.apache.logging.slf4j.Log4jLogger 所在的如下依赖从 pom 中去掉看看。</p>
<p>结果初始化时恢复到了 org.slf4j.impl.Log4jLoggerAdapter 了，问题得到解决。此时，比较下 log4j-slf4j-impl 和 slf4j-log4j12 的区别，我们可以得出以下结论：</p>
<p>log4j-slf4j-impl 是 slf4j 和 logj4 2 的 Binding，而 slf4j-log4j12 是 slf4j 和 log4j 1.2 的 Binding，com.taobao.middleware 这项服务底层硬编码只支持 slf4j-log4j12 和 logback ，并不支持 log4j2，尽管 log4j2 已经用于很多大型项目了。</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/categories/IT/">上一页</a></div><div class="pagination-next"><a href="/categories/IT/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/categories/IT/">1</a></li><li><a class="pagination-link is-current" href="/categories/IT/page/2/">2</a></li><li><a class="pagination-link" href="/categories/IT/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/IT/page/7/">7</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/about/index/logo.svg" alt="CAISKI"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">CAISKI</p><p class="is-size-6 is-block">Engineer at Tencent Inc.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">54</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">23</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/caiski" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/caiski"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/imskicai"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="/PostgresWorld" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Postgres World</span></span><span class="level-right"><span class="level-item tag">/PostgresWorld</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/IT/"><span class="level-start"><span class="level-item">IT</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile" href="/categories/Other/"><span class="level-start"><span class="level-item">Other</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-10-10T03:01:05.000Z">2021-10-10</time></p><p class="title"><a href="/2021/10/10/Li-Assisted-Driving-in-Long-Distance-Road-Trip/">Li Assisted Driving in Long Distance Road Trip</a></p><p class="categories"><a href="/categories/Other/">Other</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-22T07:16:56.000Z">2021-08-22</time></p><p class="title"><a href="/2021/08/22/Data-Type-Mappings-Between-Golang-And-PostgreSQL/">Data Type Mappings Between Golang And PostgreSQL</a></p><p class="categories"><a href="/categories/IT/">IT</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-18T05:16:42.000Z">2021-07-18</time></p><p class="title"><a href="/2021/07/18/A-Glance-Through-the-Window-of-Office-Two-Pictures/">A Glance Through the Window of Office (Two Pictures)</a></p><p class="categories"><a href="/categories/Other/">Other</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-17T12:14:17.000Z">2021-07-17</time></p><p class="title"><a href="/2021/07/17/Alfred-New-User-Notes-Part-I/">Alfred New User Notes - Part I</a></p><p class="categories"><a href="/categories/Other/">Other</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-03T15:09:23.000Z">2021-07-03</time></p><p class="title"><a href="/2021/07/03/Grpc-Tutorial-Step-By-Step/">Grpc Tutorial Step By Step</a></p><p class="categories"><a href="/categories/IT/">IT</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">二月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">一月 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">八月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">七月 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">一月 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">十二月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">十一月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">十月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">十二月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/11/"><span class="level-start"><span class="level-item">十一月 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/09/"><span class="level-start"><span class="level-item">九月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">八月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">七月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/06/"><span class="level-start"><span class="level-item">六月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">四月 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/12/"><span class="level-start"><span class="level-item">十二月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/09/"><span class="level-start"><span class="level-item">九月 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/07/"><span class="level-start"><span class="level-item">七月 2014</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/09/"><span class="level-start"><span class="level-item">九月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/09/"><span class="level-start"><span class="level-item">九月 2012</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/07/"><span class="level-start"><span class="level-item">七月 2012</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2010/12/"><span class="level-start"><span class="level-item">十二月 2010</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2010/11/"><span class="level-start"><span class="level-item">十一月 2010</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/alfred/"><span class="tag">alfred</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/algorithm/"><span class="tag">algorithm</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blockchain/"><span class="tag">blockchain</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cpp/"><span class="tag">cpp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/design-pattern/"><span class="tag">design pattern</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/emerg/"><span class="tag">emerg</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/golang/"><span class="tag">golang</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iptables/"><span class="tag">iptables</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mac/"><span class="tag">mac</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/photography/"><span class="tag">photography</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/postgresql/"><span class="tag">postgresql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/regex/"><span class="tag">regex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rpc/"><span class="tag">rpc</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shell/"><span class="tag">shell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tex/"><span class="tag">tex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/thoughts/"><span class="tag">thoughts</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/trial/"><span class="tag">trial</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tricks/"><span class="tag">tricks</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/about/index/logo.svg" alt="Slack Ideas" height="28"></a><p class="is-size-7"><span>&copy; 2022 caiski</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>